\documentclass{tufte-book}

\usepackage[utf8]{inputenc}

\usepackage{graphicx}
\setkeys{Gin}{width=\linewidth,totalheight=\textheight,keepaspectratio}

\definecolor{darkblue}{HTML}{00416A}

\usepackage{longtable}
\usepackage{booktabs}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{enumitem}

\setlength{\parskip}{2mm}
\setlist[itemize]{itemsep=0.5mm,topsep=0mm}
\setlist[enumerate]{itemsep=0.5mm,topsep=0mm}

\usepackage{boxedminipage}
\usepackage{microtype}
\usepackage{hyperref}
% attempts to prevent margin figures from being cut off
\usepackage{marginfix}
\usepackage[morefloats=100]{morefloats}

\theoremstyle{definition}
\newtheorem{Definition}{Definition}[chapter]
\newtheorem{Exercise}{Exercise}[chapter]

\newtheorem{Theorem}{Theorem}[chapter]
\newtheorem{Lemma}{Lemma}[Theorem]

\newtheorem{Fact}{Fact}[chapter]
\newtheorem{Proposition}{Proposition}[chapter]
\newtheorem{Assumption}{Assumption}[chapter]
\newtheorem{Example}{Example}[chapter]
\newtheorem{Algorithm}{Algorithm}[chapter]
% \newenvironment{Algorithm}{\begin{center}\begin{boxedminipage}{0.92\textwidth}}{\end{boxedminipage}\end{center}}
% \newenvironment{Proof}{\begin{proof}}{\end{proof}}

\newtheoremstyle{proofstyle}
  {\topsep}   % ABOVESPACE
  {\topsep}   % BELOWSPACE
  {}          % BODYFONT
  {0pt}       % INDENT (empty value is the same as 0pt)
  {\itshape}  % HEADFONT
  {.}         % HEADPUNCT
  {5pt plus 1pt minus 1pt} % HEADSPACE
  {}          % CUSTOM-HEAD-SPEC

\theoremstyle{proofstyle}
\newtheorem{Proof}{Proof}

\usepackage[framemethod=TikZ]{mdframed}

\newmdenv[
  roundcorner=5pt,
  linewidth=0pt,
  topline=false,
  bottomline=false,
  leftline=false,
  rightline=false,
  skipabove=\topsep,
  skipbelow=\topsep,
  % innerleftmargin=5pt,
  % innerrightmargin=5pt,
  innerbottommargin=15pt,
  % leftmargin=0pt,
  % rightmargin=0pt,
  backgroundcolor=black!5,
]{algorithmBox}


\newenvironment{AlgorithmShaded}{\begin{algorithmBox}\begin{Algorithm}}{\end{Algorithm}\end{algorithmBox}}


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}


% DO NOT DELETE. Required by pandoc.
% specific to pandoc 2.14 - adjust for other versions
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\titleclass{\subsubsection}{straight}
\titleformat{\subsubsection}%
  [hang]% shape
  {\normalfont\large\itshape}% format applied to label+text
  {\thesubsubsection}% label
  {1em}% horizontal separation between label and title body
  {}% before the title body
  []% after the title body

\input{templates/shared-macros}

% Enable numbering for Part, Chapter (0), Section (1), Subsection (2), Subsubsection (3), Paragraph (4), Subparagraph (5)
\setcounter{secnumdepth}{2}
% Show more in depth in table of content
\setcounter{tocdepth}{2}

$if(book-layout)$

\usepackage{ifthen}
\usepackage{chngcntr}
\counterwithout{figure}{chapter}
\counterwithout{table}{chapter}

% chapter format
\titleformat{\chapter}
  {\huge\rmfamily\itshape} % format applied to label+text
  {} % label
  {0pt} % horizontal separation between label and title body
  {\ifshowchapternumber
   \textit{\textbf{\thechapter}}\linebreak\noindent
   \else
   \fi
   \setcounter{chapter}{\thechapter} }% before the title body
  []% after the title body

\hypersetup{
  colorlinks,
  linkcolor = darkblue,
  urlcolor = darkblue,
  pdftitle = {$booktitle$},
  pdfauthor = {$bookauthors$}
}

\title{$booktitle$}
\author{$bookauthors$}

% Enable numbering for Part, Chapter (0), Section (1), Subsection (2), Subsubsection (3), Paragraph (4), Subparagraph (5)
\setcounter{secnumdepth}{2}
% Show more in depth in table of content
\setcounter{tocdepth}{2}

\newif\ifshowchapternumber


%%%% Kevin Godny's code for title page and contents from https://groups.google.com/forum/#!topic/tufte-latex/ujdzrktC1BQ
\makeatletter
\renewcommand{\maketitlepage}{%
\begingroup%
\setlength{\parindent}{0pt}

{\fontsize{24}{24}\selectfont\textit{\@author}\par}

\vspace{1.75in}{\fontsize{36}{54}\selectfont\@title\par}

\vspace{0.5in}{\fontsize{14}{14}\selectfont\textsf{\smallcaps{\@date}}\par}

\vfill{\fontsize{14}{14}\selectfont\textit{\@publisher}\par}

\thispagestyle{empty}
\endgroup
}
\makeatother

\newcommand{\theedition}{First Edition}
\newcommand{\thepublisher}{Stanford University}

\begin{document}

\frontmatter

\showchapternumberfalse

\thispagestyle{empty}

\begin{fullwidth}

\setlength{\parindent}{0pt}


{\ }

\vspace{1.75in}

{\fontsize{36}{54}\selectfont{$booktitle$}}

\vspace{1cm}
\noindent{\huge\tt $booksubtitle$}

\vspace{0.5in}{\fontsize{14}{14}\selectfont\textsf{\smallcaps{\theedition}}}

\vfill

{\fontsize{24}{24}\selectfont\textit{$bookauthors$}}

\vspace{0.5in}

{\fontsize{14}{14}\selectfont\textit{\thepublisher}}

% ~\vspace{4cm}

% \noindent{\Huge\tt\uppercase{$booktitle$}}

% \vspace{1cm}

% \noindent{\huge\tt $booksubtitle$}

% \vspace{3cm}

% \noindent{\huge\it $bookauthors$}

\pagebreak

\thispagestyle{empty}

\noindent Last updated: $lastupdate$

\end{fullwidth}

{
  \setlength{\parskip}{0pt}
  \tableofcontents
  }

\mainmatter

\showchapternumbertrue

$body$

\backmatter

\showchapternumberfalse

\listoffigures
\listoftables

$endif$

$if(chapter-layout)$

% Set chapter counter to $chapter-number$
\setcounter{chapter}{$chapter-number$}

\hypersetup{
  colorlinks,
  linkcolor = darkblue,
  urlcolor = darkblue,
  pdftitle = {$booktitle$ - $title$},
  pdfauthor = {$bookauthors$}
}

% \title{$booktitle$ - $lastupdate$}
\title{}
\author{$bookauthors$}

\begin{document}

\noindent {\huge\textit{\textbf{$chapter-number$}}}

\vspace{1cm}

\noindent {\huge\it $title$}

\vspace{1.5cm}

$body$

$endif$

\end{document}
